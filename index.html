<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESTOQUE DO EST√öDIO RICK TATUADOR</title>

<style>
:root{
--bg:#f2f2f2;
--box:#ffffff;
--text:#000;
--footer:#555;
}

body{
font-family:Arial;
background:var(--bg);
color:var(--text);
margin:0;
padding:10px;
transition:0.3s;
}

h1{text-align:center}

.box{
background:var(--box);
padding:10px;
margin-bottom:10px;
border-radius:8px;
transition:0.3s;
}

input,select,button{
width:100%;
padding:8px;
margin:4px 0;
}

.item{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:5px;
}

.controls button{
width:auto;
margin-left:4px;
}

.cat-controls button,
.prod-controls button{
width:auto;
margin-left:4px;
}

.zero{color:red;font-weight:bold}
.low{color:orange;font-weight:bold}
.highlight{background:#ffff99;border-radius:4px}

.footer{
margin-top:20px;
text-align:center;
color:var(--footer);
font-size:14px
}

.clear-btn{
margin-top:4px;
background:#f44336;
color:white;
border:none;
padding:6px 8px;
border-radius:4px;
cursor:pointer;
}

/* Anima√ß√£o */
button{
transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.08s ease;
cursor:pointer;
}

button:active{
transform: scale(0.95);
box-shadow: 0 2px 4px rgba(0,0,0,0.3) inset;
opacity: 0.85;
}

/* Dark */
body.dark{
--bg:#121212;
--box:#1e1e1e;
--text:#f5f5f5;
--footer:#aaa;
}

body.dark .highlight{
background:#333;
}

/* Bot√£o tema */
.theme-toggle{
position:fixed;
bottom:20px;
right:20px;
width:50px;
height:50px;
border-radius:50%;
border:none;
font-size:20px;
background:#000;
color:#fff;
z-index:10000;
}

body.dark .theme-toggle{
background:#fff;
color:#000;
}
</style>
</head>
<body>

<script>
let user = prompt("Digite seu nome:");
</script>

<h1>ESTOQUE DO EST√öDIO RICK TATUADOR</h1>

<div class="box">
<input id="search" placeholder="üîç Pesquisar produto">
<button onclick="buscarProduto()">Pesquisar</button>
</div>

<div class="box">
<select id="catSelect"></select>
<input id="newCat" placeholder="Ou nova categoria">
<input id="newName" placeholder="Produto">
<input id="newQty" type="number" placeholder="Quantidade">
<button onclick="addProduct()">Adicionar</button>
</div>

<div id="stock"></div>

<div class="footer" id="footer"></div>

<button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "SUA_KEY",
authDomain: "SEU_AUTH",
projectId: "SEU_PROJECT",
storageBucket: "SEU_BUCKET",
messagingSenderId: "SEU_ID",
appId: "SEU_APP"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let data = {};
let lastFound = null;

const BUILD_VERSION = Date.now();
document.getElementById("footer").innerHTML = `
Vers√£o do App: Build ${BUILD_VERSION}<br>
Criado por: Denis Costa
`;

onSnapshot(doc(db,"estoque","principal"),snap=>{
if(snap.exists()){data=snap.data().data||{};render();}
});

async function save(){
await setDoc(doc(db,"estoque","principal"),{data});
}

window.addProduct=async()=>{
let cat=newCat.value||catSelect.value;
if(!cat||!newName.value)return alert("Preencha tudo");
if(!data[cat])data[cat]={};
data[cat][newName.value]=parseInt(newQty.value)||0;
newCat.value=newName.value=newQty.value="";
await save();
};

window.changeQty=async(cat,prod,delta)=>{
data[cat][prod]+=delta;
if(data[cat][prod]<0)data[cat][prod]=0;
await save();
};

window.deleteProduct=async(cat,prod)=>{
if(!confirm("Excluir produto?"))return;
delete data[cat][prod];
await save();
};

window.editProduct=async(cat,prod)=>{
let novo=prompt("Novo nome do produto:",prod);
if(!novo||novo===prod)return;
data[cat][novo]=data[cat][prod];
delete data[cat][prod];
await save();
};

window.deleteCategory=async(cat)=>{
if(!confirm("Excluir categoria inteira?"))return;
delete data[cat];
await save();
};

window.editCategory=async(cat)=>{
let novo=prompt("Novo nome da categoria:",cat);
if(!novo||novo===cat)return;
data[novo]=data[cat];
delete data[cat];
await save();
};

window.buscarProduto=()=>{
const termo=search.value.toLowerCase();
if(lastFound)lastFound.classList.remove("highlight");
const el=Array.from(document.querySelectorAll('[data-prod]'))
.find(d=>d.dataset.prod.includes(termo));
if(el){
el.scrollIntoView({behavior:"smooth",block:"center"});
el.classList.add("highlight");
lastFound=el;
}else alert("Produto n√£o encontrado");
};

function render(){
stock.innerHTML="";
catSelect.innerHTML="";
Object.keys(data).forEach(cat=>{
catSelect.innerHTML+=`<option>${cat}</option>`;
let b=document.createElement("div");
b.className="box";

let header=`
<div style="display:flex;justify-content:space-between;align-items:center;">
<h3>${cat}</h3>
<div class="cat-controls">
<button onclick="editCategory('${cat}')">Editar</button>
<button onclick="deleteCategory('${cat}')">Excluir</button>
</div>
</div>
`;

b.innerHTML=header;

Object.keys(data[cat]).forEach(p=>{
let q=data[cat][p];
let cls=q===0?"zero":q<5?"low":"";
b.innerHTML+=`
<div class="item" data-prod="${p.toLowerCase()}">
<span class="${cls}">${p}: ${q}</span>
<div class="prod-controls">
<button onclick="changeQty('${cat}','${p}',-1)">-</button>
<button onclick="changeQty('${cat}','${p}',1)">+</button>
<button onclick="editProduct('${cat}','${p}')">Editar</button>
<button onclick="deleteProduct('${cat}','${p}')">Excluir</button>
</div>
</div>`;
});

stock.appendChild(b);
});
}

window.toggleTheme=()=>{
document.body.classList.toggle("dark");
localStorage.setItem("theme",document.body.classList.contains("dark"));
document.getElementById("themeBtn").textContent=
document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
};

if(localStorage.getItem("theme")==="true"){
document.body.classList.add("dark");
document.getElementById("themeBtn").textContent="‚òÄÔ∏è";
}

</script>

</body>
</html>
