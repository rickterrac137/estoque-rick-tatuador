<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESTOQUE DO EST√öDIO RICK TATUADOR</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:10px}
h1{text-align:center}

.tabs{display:flex;gap:6px;margin-bottom:10px}
.tabs button{flex:1;padding:10px;border:none;border-radius:8px;background:#ddd}
.tabs button.active{background:#000;color:#fff}

.box{background:#fff;padding:10px;margin-bottom:10px;border-radius:8px}
input,select,button{width:100%;padding:8px;margin:4px 0}

.item{display:flex;justify-content:space-between;align-items:center}
.controls button{width:auto;margin-left:4px}

.zero{color:red;font-weight:bold}
.low{background:#ffe5e5;padding:2px 6px;border-radius:4px;font-size:12px}
.hidden{display:none}

.footer{text-align:center;font-size:12px;color:#666;margin-top:20px}
</style>
</head>

<body>

<script>
const APP_VERSION = "v1.7.0";
let user = prompt("Digite seu nome:") || "Usu√°rio";

function now(){
  const d=new Date();
  return d.toLocaleDateString("pt-BR")+" "+d.toLocaleTimeString("pt-BR");
}
</script>

<h1>ESTOQUE DO EST√öDIO RICK TATUADOR</h1>

<div class="tabs">
  <button id="btnEstoque" class="active">üì¶ Estoque</button>
  <button id="btnHistorico">üìú Hist√≥rico</button>
</div>

<!-- ABA ESTOQUE -->
<div id="estoqueTab">

  <div class="box">
    <select id="catSelect"></select>
    <input id="newCat" placeholder="Nova categoria">
    <input id="newName" placeholder="Produto">
    <input id="newQty" type="number" placeholder="Quantidade">
    <button onclick="addProduct()">Adicionar</button>
  </div>

  <div id="stock"></div>
</div>

<!-- ABA HIST√ìRICO -->
<div id="historicoTab" class="hidden">
  <div class="box">
    <h3>‚ûï Adi√ß√µes</h3>
    <div id="histAdd"></div>
  </div>
  <div class="box">
    <h3>‚ûñ Remo√ß√µes</h3>
    <div id="histRem"></div>
  </div>
</div>

<div class="footer">
  <div>Vers√£o do app: <b id="ver"></b></div>
  <div>app oficial do denis costa</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBPF8DpKpIHpYsdTRNCgHgiwCqUcosLX6c",
  authDomain: "estoque-rick-tatuador.firebaseapp.com",
  projectId: "estoque-rick-tatuador"
});

const db=firebase.firestore();
let data={},adds=[],rems=[];

async function load(){
  const p=await db.doc("estoque/principal").get();
  if(p.exists) data=p.data().data||{};
  const h=await db.doc("estoque/history").get();
  if(h.exists){
    adds=h.data().adds||[];
    rems=h.data().rems||[];
  }
  render();
}

async function save(){
  await db.doc("estoque/principal").set({data});
  await db.doc("estoque/history").set({adds,rems});
}

function addProduct(){
  let c=newCat.value||catSelect.value;
  if(!c||!newName.value) return alert("Preencha tudo");
  if(!data[c]) data[c]={};
  data[c][newName.value]=parseInt(newQty.value)||0;
  adds.unshift(`‚ûï ${newName.value} (${user}) ‚Äî ${now()}`);
  newCat.value=newName.value=newQty.value="";
  save();render();
}

function changeQty(c,p,d){
  data[c][p]+=d;
  if(data[c][p]<0) data[c][p]=0;
  (d>0?adds:rems).unshift(`${d>0?'‚ûï':'‚ûñ'} ${p} (${user}) ‚Äî ${now()}`);
  save();render();
}

function editCategory(oldC){
  let n=prompt("Novo nome:",oldC);
  if(n&&n!==oldC){
    data[n]=data[oldC]; delete data[oldC];
    save();render();
  }
}

function deleteCategory(c){
  if(confirm("Excluir categoria inteira?")){
    delete data[c];
    save();render();
  }
}

function editProduct(c,p){
  let n=prompt("Novo nome:",p);
  if(n&&n!==p){
    data[c][n]=data[c][p]; delete data[c][p];
    save();render();
  }
}

function deleteProduct(c,p){
  if(confirm("Excluir produto?")){
    delete data[c][p];
    save();render();
  }
}

function render(){
  stock.innerHTML=""; catSelect.innerHTML="";
  histAdd.innerHTML=adds.slice(0,20).map(x=>`<div>${x}</div>`).join("");
  histRem.innerHTML=rems.slice(0,20).map(x=>`<div>${x}</div>`).join("");

  for(let c in data){
    catSelect.innerHTML+=`<option>${c}</option>`;
    let b=document.createElement("div");
    b.className="box";
    b.innerHTML=`<h3>${c}
      <button onclick="editCategory('${c}')">‚úèÔ∏è</button>
      <button onclick="deleteCategory('${c}')">üóëÔ∏è</button>
    </h3>`;
    for(let p in data[c]){
      let q=data[c][p];
      b.innerHTML+=`
      <div class="item">
        <span class="${q<=2?'zero':''}">
          ${p}: ${q} ${q<=2?'<span class="low">‚ö†Ô∏è estoque baixo</span>':''}
        </span>
        <span class="controls">
          <button onclick="changeQty('${c}','${p}',-1)">‚àí</button>
          <button onclick="changeQty('${c}','${p}',1)">+</button>
          <button onclick="editProduct('${c}','${p}')">‚úèÔ∏è</button>
          <button onclick="deleteProduct('${c}','${p}')">üóëÔ∏è</button>
        </span>
      </div>`;
    }
    stock.appendChild(b);
  }
}

btnEstoque.onclick=()=>{estoqueTab.classList.remove("hidden");historicoTab.classList.add("hidden");btnEstoque.classList.add("active");btnHistorico.classList.remove("active")}
btnHistorico.onclick=()=>{historicoTab.classList.remove("hidden");estoqueTab.classList.add("hidden");btnHistorico.classList.add("active");btnEstoque.classList.remove("active")}

document.getElementById("ver").innerText=APP_VERSION;
load();
</script>

</body>
</html>
